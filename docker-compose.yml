services:
  collector:
    build: .
    command: ["python", "app.py", "--mode", "gather", "--interval", "60", "--quiet"]
    environment:
      - CADDO911_DB_PATH=/data/caddo911.db
    volumes:
      - /mnt/Pool3x2/Caddo911/data:/data
    restart: unless-stopped
    read_only: true
    tmpfs:
      - /tmp
    cap_drop:
      - ALL
    security_opt:
      - no-new-privileges:true
    networks:
      - repo_default

  web:
    build: .
    command: ["gunicorn", "-w", "1", "-b", "0.0.0.0:3911", "app:app"]
    environment:
      - CADDO911_DB_PATH=/data/caddo911.db
    volumes:
      - /mnt/Pool3x2/Caddo911/data:/data
    depends_on:
      - collector
    restart: unless-stopped
    read_only: true
    tmpfs:
      - /tmp
    cap_drop:
      - ALL
    security_opt:
      - no-new-privileges:true
    networks:
      - repo_default

networks:
  repo_default:
    external: true